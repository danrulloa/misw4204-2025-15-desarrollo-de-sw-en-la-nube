# ---------------------------------------
# prometheus/prometheus.yml
# ---------------------------------------
# Scrapea a sí mismo y a exporters/servicios que expongan /metrics.
# Agrega aquí tus targets (API, workers) cuando instrumentes con prometheus_client.

# Prometheus config
---
global:
  scrape_interval: 10s
  evaluation_interval: 30s

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ['__OBS_IP__:9090']


  - job_name: rabbitmq
    static_configs:
      - targets: ['__MQ_IP__:15692']

  - job_name: cadvisor
    static_configs:
      - targets:
        - "__AUTH_IP__:8080"
        - "__MQ_IP__:8080"
        - "__WORKER_IP__:8080"

  - job_name: "api-auth"
    metrics_path: /auth/metrics
    static_configs:
      - targets: ["__AUTH_IP__:8001"]

  # Core se autoescala vía ASG; Prometheus no descubre dinámicamente esas IPs aquí.
  # Opcional: habilitar discovery por AWS o exportar métricas vía ALB con rewrites.

  - job_name: "worker"
    metrics_path: /metrics
    static_configs:
      - targets: ["__WORKER_IP__:9100"]

